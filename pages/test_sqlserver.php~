<?php
/*
echo "Test<br>";
//format: serverName\instanceName, portNumber (default is 1433)
$serverName = "vm-isdb1.comune.genova.it";


$connectionInfo = array( "Database"=>"is_manutenzioni", "UID"=>"emergenze_prtcv", "PWD"=>'$prot_civ1$');
echo "OK<br>";
$conn = sqlsrv_connect( $serverName, $connectionInfo);

if( $conn ) {
     echo "Got a connection!<br />";
}else{
     echo "Connection could not be established.<br />";
     die( print_r( sqlsrv_errors(), true));
}*/


?>


<?php
echo "TEST CONNESSIONE SQL SERVER<br>";

$serverName = "vm-isdb1.comune.genova.it";
$connectionOptions = array(
    "database" => "is_manutenzioni",
    "uid" => "emergenze_prtcv",
    "pwd" => '$prot_civ1$'
);

echo "Parametri di connessione correttamente definiti<br>";
// Establishes the connection
$conn = sqlsrv_connect($serverName, $connectionOptions);
if ($conn === false) {
    die(formatErrors(sqlsrv_errors()));
}

echo "Connessione effettuata";
// Select Query
$tsql = "SELECT @@Version AS SQL_VERSION";

// Executes the query
$stmt = sqlsrv_query($conn, $tsql);

// Error handling
if ($stmt === false) {
    die(formatErrors(sqlsrv_errors()));
}
?>

<h1> Results : </h1>

<?php
while ($row = sqlsrv_fetch_array($stmt, SQLSRV_FETCH_ASSOC)) {
    echo $row['SQL_VERSION'] . PHP_EOL;
}

sqlsrv_free_stmt($stmt);
sqlsrv_close($conn);

function formatErrors($errors)
{
    // Display errors
    echo "Error information: <br/>";
    foreach ($errors as $error) {
        echo "SQLSTATE: ". $error['SQLSTATE'] . "<br/>";
        echo "Code: ". $error['code'] . "<br/>";
        echo "Message: ". $error['message'] . "<br/>";
    }
}
?>

