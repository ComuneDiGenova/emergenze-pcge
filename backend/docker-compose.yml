# version: "3"
services:

  backend:
    user: ${UID}:${GID}
    env_file:
      - .env
    build:
      context: .
      dockerfile: dev.Dockerfile
    network_mode: host
    stdin_open: true
    tty: true
    volumes:
      - .:/home/py4web/apps/emergenze
      - ${UPLOADS:-../../emergenze_uploads}:/home/py4web/apps/emergenze/emergenze_uploads
    command: py4web run --password_file password.txt --host 0.0.0.0 --port 8000 apps
    restart: unless-stopped

  db-listener:
    user: ${UID}:${GID}
    env_file:
      - .env
    build:
      context: .
      dockerfile: dev.Dockerfile
    network_mode: host
    stdin_open: true
    tty: true
    volumes:
      - .:/home/py4web/apps/emergenze
      - ${UPLOADS:-../../emergenze_uploads}:/home/py4web/apps/emergenze/emergenze_uploads
    command: py4web call apps emergenze.listener.listen
    restart: unless-stopped
